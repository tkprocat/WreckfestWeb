# Wreckfest Server Admin Panel - Project Context

> **Last Updated:** 2025-10-24
> **Status:** Active Development
> **Current Branch:** main

---

## Project Overview

**Wreckfest Server Admin Panel** is a comprehensive web-based administration and monitoring system for managing Wreckfest dedicated game servers. It provides both a public-facing status page and a full-featured admin dashboard for server configuration, track rotation management, and real-time monitoring.

The application bridges the gap between Wreckfest game servers (which expose an API on `https://localhost:5101`) and administrators, allowing them to manage all aspects of their game server without direct server access.

---

## Technology Stack

- **Backend:** PHP 8.2+ with Laravel 12.0
- **Admin Framework:** Filament 4.0 (recently upgraded from v3)
- **Frontend:** Livewire 3, Tailwind CSS 4.1, Alpine.js, Blade
- **Build Tool:** Vite 7.0
- **Database:** SQLite (development, configurable)
- **Testing:** Pest & PHPUnit
- **Package Managers:** Composer, npm

---

## Key Features

### Public Homepage (`/`)
- Real-time server status (online/offline indicator with animated pulse)
- Live player count display (e.g., "5/24 players")
- Current connected players list with bot detection
- **Track rotation display** with current track highlighted (orange glow + "NOW PLAYING" badge)
- **Responsive layout**: Players and Track Rotation side-by-side on large screens
- Track images (right-aligned thumbnails) with fallback icons
- Shows collection name, track names, locations, gamemode, laps, and bots
- Scrollable track list (max height 96) for long rotations
- Auto-refresh every 30 seconds
- Beautiful dark-themed UI with Wreckfest branding (orange #a03d00)
- Gradient metal texture design matching the game's aesthetic

### Admin Panel (`/admin`)
Requires authentication. Features include:

1. **Server Configuration** - Complete server settings management
2. **Track Browser** - Searchable catalog of 122+ track variants
3. **Track Rotation Manager** - Add/remove/reorder tracks with per-track settings
4. **Server Control** - Start/stop/restart server controls
5. **Server Logs** - View last 100+ log lines
6. **Current Players Dashboard** - Real-time player monitoring widget
7. **User Management** - Create/edit/view admin users

---

## Project Structure

```
F:\Projects\Web\WreckfestWeb\
├── app/
│   ├── Filament/
│   │   ├── Pages/              # Admin panel pages (ServerConfig, TrackRotation, etc.)
│   │   ├── Resources/          # User CRUD resource
│   │   └── Widgets/            # CurrentPlayersWidget
│   ├── Http/Controllers/
│   │   └── HomeController.php  # Public homepage controller
│   ├── Services/
│   │   └── WreckfestApiClient.php  # API client for Wreckfest server
│   ├── Helpers/
│   │   └── TrackHelper.php     # Track compatibility utilities
│   ├── Models/                 # User, TrackCollection, Invitation
│   ├── Mail/
│   ├── Exceptions/
│   └── Providers/
├── config/
│   └── wreckfest.php           # MASSIVE game config (~1200 lines)
├── resources/
│   ├── views/
│   │   ├── home.blade.php      # Public homepage
│   │   ├── components/         # Wreckfest-themed inputs
│   │   └── filament/           # Admin page views
│   └── css/
├── routes/
│   └── web.php
├── database/
│   ├── migrations/
│   └── seeders/
└── tests/
```

---

## Core Services

### WreckfestApiClient (`app/Services/WreckfestApiClient.php`)

HTTP client that communicates with Wreckfest game server API.

**Key Methods (Verified against API v1.0):**
- `getServerConfig()` - GET `/Config/basic`
- `updateServerConfig(array)` - PUT `/Config/basic`
- `getTrackCollectionName()` - GET `/Config/tracks/collection-name` ✨ **NEW**
- `getTracks()` - GET `/Config/tracks`
- `updateTracks(array)` - PUT `/Config/tracks`
- `getServerStatus()` - GET `/Server/status`
- `startServer()` - POST `/Server/start`
- `stopServer()` - POST `/Server/stop`
- `restartServer()` - POST `/Server/restart`
- `attachToServer(int)` - POST `/Server/attach/{pid}`
- `getLogFile(int)` - GET `/Server/logfile`
- `getPlayers()` - GET `/Server/players`

**⚠️ Potentially Deprecated Methods (Not in Swagger v1.0):**
- `addTrack(array)` - POST `/Config/tracks` (may not work)
- `updateTrack(int, array)` - PUT `/Config/tracks/{index}` (may not work)
- `deleteTrack(int)` - DELETE `/Config/tracks/{index}` (may not work)

**Configuration:**
- Base URL: `https://localhost:5101/api` (configurable via `WRECKFEST_API_URL`)
- 5-second timeout
- SSL verification disabled (development only)
- Comprehensive error logging

**Last API Verification:** 2025-10-24 - Swagger spec fetched from `https://localhost:5101/swagger/v1/swagger.json`

### TrackHelper (`app/Helpers/TrackHelper.php`)

Utility class for track compatibility logic:
- Track/gamemode compatibility validation
- Derby vs Racing gamemode detection
- Weather support validation
- Track categorization (derby-only arenas vs racing tracks)

---

## Game Configuration (`config/wreckfest.php`)

Comprehensive game data (~1200 lines):

- **Tracks:** 47 locations with 122+ variants (hierarchical structure)
- **Game Modes:** Racing, Derby, Derby Deathmatch, Team Deathmatch, Team Race, Elimination Race
- **Track Weather Compatibility:** Track-specific restrictions
- **Session Modes:** 14 types (F1 scoring, qualifying, etc.)
- **Cars:** 200+ vehicles with variants
- **AI Settings:** Difficulties, grid orders, damage modes
- **Brand Colors:** Primary: #a03d00 (Wreckfest orange)

---

## Recent Changes (2025-10-24)

### ✅ Completed Features

1. **Track Rotation Display on Homepage**
   - Added `getTrackCollectionName()` method to WreckfestApiClient
   - Updated HomeController to fetch track rotation and collection name
   - Removed debugging `var_dump()` statements
   - Added track enrichment methods to show human-readable track names
   - Implemented beautiful track rotation display with current track highlighting
   - **Track images** displayed for each track (128x80px thumbnails on right side)
   - **Responsive layout**: Side-by-side on large screens, stacked on mobile
   - Shows collection name, track details, gamemode, laps, and bots
   - Current track gets animated orange pulse indicator and "NOW PLAYING" badge
   - Max height of 96 with scrollbar for long rotations
   - Fixed typo: "Roation" → "Rotation"
   - Format: **Location Name** as title, **Variant Name** as subtitle

2. **TrackHelper Enhancements**
   - Added `getTrackDetails()` method - returns full track information array
   - Added `getTrackName()` method - convenience method for quick name lookup
   - Returns location, variant, full name, derby status, and weather support

3. **API Verification**
   - Verified all endpoints against Swagger spec v1.0
   - Identified 3 potentially deprecated methods (addTrack, updateTrack, deleteTrack)
   - All current endpoints now documented and verified

### Active Changes (Uncommitted)

1. **WreckfestApiClient.php**
   - Added `getTrackCollectionName()` method
   - Ready for commit

2. **HomeController.php**
   - Cleaned up debugging code
   - Added track rotation fetching and enrichment
   - Simplified using TrackHelper instead of custom methods
   - Added TrackHelper import
   - Ready for commit

3. **TrackHelper.php**
   - Added `getTrackDetails()` method - returns comprehensive track information
   - Added `getTrackName()` method - convenience method for quick lookups
   - Ready for commit

4. **home.blade.php**
   - Complete track rotation display implementation
   - Track images (128x80px) displayed on the **right side** of each card
   - Images are vertically and horizontally centered
   - **Side-by-side layout** on large screens (lg breakpoint): Players on left, Track Rotation on right
   - **Stacked layout** on mobile/tablet (single column)
   - Highlights current track with orange glow and animation
   - Format changed: Location Name as title, Variant as subtitle
   - Shows track metadata (gamemode, laps, bots)
   - Fallback icon if image doesn't exist
   - Ready for commit

5. **app/Livewire/** (New directory)
   - Untracked directory - purpose unknown
   - Needs investigation

### Recent Commits
- `db29742` - Fixed formatting
- `297e117` - Disabled Manage Collection (incomplete feature)
- `eca15ea` - Updated Filament to v4 (major upgrade)
- `338b46d` - Updated Track Browser (image format, tag visibility, derby classification)
- `efd73a0` - Fixed config saving to server

---

## Known Issues & TODO

1. **Ready to Commit**
   - Track rotation feature is complete and ready for git commit
   - Files changed: WreckfestApiClient.php, HomeController.php, TrackHelper.php, home.blade.php
   - Track images path: `public/images/tracks/{trackId}.png`

2. **Manage Collection Feature**
   - Currently disabled (commit 297e117)
   - Needs completion or removal

3. **Livewire Directory**
   - Investigate purpose of new `app/Livewire/` directory
   - Either complete implementation or remove

4. **Deprecated API Methods**
   - Consider removing or marking deprecated: `addTrack()`, `updateTrack()`, `deleteTrack()`
   - These methods are not in the official Swagger spec

---

## Quick Reference

### Setup Commands
```bash
composer run setup   # Install dependencies, generate key, run migrations, build frontend
composer run dev     # Run dev server with live reload
```

### Environment Variables
```env
WRECKFEST_API_URL=https://localhost:5101/api
DB_CONNECTION=sqlite
# Email config for invitations
# App key generation required
```

### Key Routes
- `/` - Public homepage
- `/admin` - Admin dashboard
- `/admin/login` - Admin login
- `/admin/server-config` - Server configuration
- `/admin/track-rotation` - Track rotation manager
- `/admin/track-browser` - Track browser
- `/admin/server-control` - Server control panel

### Important File Paths
```
app/Http/Controllers/HomeController.php          # Public homepage controller
app/Services/WreckfestApiClient.php              # API client
app/Helpers/TrackHelper.php                      # Track utilities
app/Filament/Pages/TrackRotation.php             # Track rotation manager
config/wreckfest.php                             # Game configuration
resources/views/home.blade.php                   # Public homepage view
```

---

## Development Notes

### Design Patterns
- **Service Layer:** API communication abstracted in WreckfestApiClient
- **Helper Classes:** TrackHelper for business logic
- **Blade Components:** Reusable Wreckfest-themed inputs
- **Filament Pages:** Self-contained page classes with forms/actions
- **Session Management:** Track collection context in session

### Track Compatibility System
Tracks have complex compatibility requirements:
- **Derby vs Racing:** Some tracks are derby-only (arenas), others racing-only
- **Weather Support:** Track-specific weather restrictions (e.g., Sandstone only supports clear)
- **Gamemode Restrictions:** Derby gamemodes can only use derby-compatible tracks

The `TrackHelper` class centralizes all this validation logic.

### Security
- Laravel authentication system
- Filament auth middleware
- User registration with email validation
- CSRF protection
- SSL verification disabled for localhost (dev only - noted in README)

---

## Next Steps (Recommendations)

1. **Clean up debugging code** in HomeController.php
2. **Complete or remove** the Current Track Rotation section on homepage
3. **Investigate** the new Livewire directory
4. **Complete or remove** Manage Collection feature
5. **Test** recent Filament v4 upgrade thoroughly
6. **Review** all pages for any breaking changes from Filament upgrade

---

## Context for Claude

**What this file is for:** This document serves as a comprehensive reference for Claude Code in future sessions. It contains project structure, current work, known issues, and technical decisions.

**How to use it:** Read this file at the start of each session to understand:
- What the project does
- What we're currently working on
- What needs attention
- Where key files are located

**Keep it updated:** When significant changes are made, update this file to reflect the current state.

---

*End of Project Context Document*
